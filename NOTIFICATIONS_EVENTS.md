# Система уведомлений - События

## Текущие события уведомлений

### 1. Ответ на дискуссию (`reply_to_discussion`)
**Когда отправляется:**
- Когда пользователь отвечает на дискуссию, созданную другим пользователем
- Не отправляется, если пользователь отвечает на свою собственную дискуссию

**Содержание:**
- Заголовок: "New reply to your discussion"
- Текст: "{Имя автора} replied to "{Название дискуссии}""
- URL: `/forum/{discussion_id}`

**Реализация:**
- Триггер в БД: `on_reply_notification` в таблице `forum_replies`
- Функция: `send_reply_notification()`

---

## Планируемые события (можно добавить позже)

### 2. Реакция на пост (`reaction_to_post`)
**Когда отправляется:**
- Когда кто-то ставит реакцию (like, helpful, insightful) на дискуссию пользователя

**Содержание:**
- Заголовок: "New reaction"
- Текст: "{Имя автора} {тип реакции} your post"

### 3. Реакция на ответ (`reaction_to_reply`)
**Когда отправляется:**
- Когда кто-то ставит реакцию на ответ пользователя

**Содержание:**
- Заголовок: "New reaction"
- Текст: "{Имя автора} {тип реакции} your reply"

### 4. Новый фолловер (`new_follower`)
**Когда отправляется:**
- Когда кто-то начинает следовать за пользователем

**Содержание:**
- Заголовок: "New follower"
- Текст: "{Имя пользователя} started following you"

### 5. Упоминание (`mention`)
**Когда отправляется:**
- Когда пользователя упоминают в посте или ответе (например, @username)

**Содержание:**
- Заголовок: "You were mentioned"
- Текст: "{Имя автора} mentioned you in a discussion"

---

## Настройки пользователя

### По умолчанию (для новых пользователей):
- `email_notifications`: `false` (выключено)
- `push_notifications`: `false` (выключено)

### Где хранятся настройки:
- В таблице `profiles`: поля `email_notifications` и `push_notifications`
- В `localStorage`: полные настройки пользователя (синхронизируются с БД для уведомлений)

---

## Технические детали

### База данных:
- Таблица `notifications` - хранит историю всех уведомлений
- Триггеры в БД автоматически создают записи в `notifications`
- Edge Function `send-notification` обрабатывает отправку email (пока только логирует)

### Фронтенд:
- `NotificationManager` компонент - инициализирует push уведомления и слушает real-time обновления
- `useNotifications` хук - для получения и управления уведомлениями
- `useUserPreferences` - синхронизирует настройки с БД

### Push уведомления:
- Используют браузерный API `Notification`
- Требуют разрешения пользователя
- Работают только если `push_notifications = true` в настройках

### Email уведомления:
- Пока только логируются в Edge Function
- Для реальной отправки нужно интегрировать сервис (Resend, SendGrid, etc.)

